name: Deploy Frontend to Production

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy React App to Windows Server
    runs-on: self-hosted
    environment: production
    
    steps:
      - name: Verificar ruta del proyecto
        run: |
          if (-Not (Test-Path C:\Projects\interface-layer)) {
            Write-Host "Error: La ruta no existe" -ForegroundColor Red
            exit 1
          }
          Write-Host "Ruta del proyecto verificada" -ForegroundColor Green
        shell: powershell

      - name: Pull latest changes
        run: |
          cd C:\Projects\interface-layer
          Write-Host "Descargando cambios desde GitHub..." -ForegroundColor Cyan
          git fetch origin
          git reset --hard origin/main
          Write-Host "Codigo actualizado desde GitHub" -ForegroundColor Green
          git log --oneline -1
        shell: powershell

      - name: Ejecutar build
        run: |
          cd C:\Projects\interface-layer
          Write-Host "Compilando proyecto..." -ForegroundColor Cyan
          npm install
          if ($LASTEXITCODE -ne 0) { exit 1 }
          $env:CI = "false"
          npm run build
          if ($LASTEXITCODE -ne 0) { exit 1 }
          Write-Host "Compilacion exitosa" -ForegroundColor Green
        shell: powershell

      - name: Post-deploy
        run: |
          cd C:\Projects\interface-layer
          Write-Host "ðŸ”„ AplicaciÃ³n frontend actualizada" -ForegroundColor Green
        shell: powershell

      - name: Resumen del deployment
        run: |
          Write-Host "================================" -ForegroundColor Cyan
          Write-Host "DEPLOYMENT COMPLETADO" -ForegroundColor Green
          Write-Host "================================" -ForegroundColor Cyan
          Write-Host "Proyecto: C:\Projects\interface-layer" -ForegroundColor White
          Write-Host "Ambiente: production" -ForegroundColor White
          Write-Host "Ejecutado por: ${{ github.actor }}" -ForegroundColor White
          Write-Host "================================" -ForegroundColor Cyan
        shell: powershell
